---
- name: Register Host to Satellite 6.5
  hosts: localhost
  become: yes
  become_user: root
  vars:
    # Put your satellite server FQDN name here
    server: server.domain.com
    # Put your Satellite Organization name here
    org: OrgName
    # Put your lifeCycle you are going to register here.
    lifeCycleEnv: lab

  tasks:
    - name: 'Download bootstrap.py from {{ server }}'
      get_url:
        url: 'https://{{ server }}/pub/bootstrap.py'
        dest: /tmp/
        validate_certs: no

    - name: Make bootstrap.py executable
      file:
        path: /tmp/bootstrap.py
        owner: root
        group: root
        mode: 0744

    - name: Register to '{{ server }}'
      redhat_subscription:
        state: present
        org_id: '{{ org }}'
        activationkey: '{{lifeCycleEnv}}-rhel{{ ansible_distribution_major_version }}'  

    - name: Install insights-client
      yum:
        name: insights-client
        state: latest

    - name: Register insights 
      command: insights-client --register
      register: insights_output
    - name: Print insights output
      debug:
        msg: '{{ insights_output }}'


